<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Real-time Product Counts</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { font-family: Arial, sans-serif; margin: 40px; }
  canvas { max-width: 800px; }
</style>
</head>
<body>

<h2>Real-time Product Counts</h2>
<canvas id="chart"></canvas>

<script>
  const ctx = document.getElementById('chart').getContext('2d');

  // Chart.js setup
  const chart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: [], // product IDs
      datasets: [{
        label: 'Count',
        data: [],
        backgroundColor: 'rgba(54, 162, 235, 0.7)',
      }]
    },
    options: {
      animation: false,
      scales: {
        y: { beginAtZero: true, precision: 0 }
      }
    }
  });

  const counts = {};  // Track product counts

  // Connect to websocket
  const ws = new WebSocket("ws://localhost:6789");

  ws.onopen = () => {
    console.log("Connected to WebSocket");
  };

  ws.onmessage = event => {
    // Expect message format: productId:count (e.g. "productA:5")
    const [product, countStr] = event.data.split(":");
    const count = parseInt(countStr, 10);

    counts[product] = count;

    // Update chart data
    chart.data.labels = Object.keys(counts);
    chart.data.datasets[0].data = Object.values(counts);
    chart.update();
  };

  ws.onerror = err => {
    console.error("WebSocket error:", err);
  };
</script>

</body>
</html>
